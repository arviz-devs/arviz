dist: xenial

language: python

services:
  - docker

matrix:
  include:
  - name: "Python 3.6 Unit Test"
    python: 3.6
    env: PYSTAN_VERSION=latest NAME="UNIT"
  - name: "Python 3.5 Unit Test"
    python: 3.5
    env: PYSTAN_VERSION=latest NAME="UNIT"
  - name: "Python 3.6 Lint"
    python: 3.6
    env: PYSTAN_VERSION=latest NAME="LINT"
  - name: "Python 3.6 Sphinx"
    python: 3.6
    env: PYSTAN_VERSION=latest NAME="SPHINX"

addons:
  apt_packages:
    - pandoc

before_install:
  - docker pull conda/miniconda3

install:
  - sudo apt-get -qq update
  - . ./scripts/container.sh --build
  # Print conda details
  - docker run --rm -it arviz:latest /bin/bash -c "conda info -a"

  # Print conda environment details
  - docker run --rm -it arviz:latest /bin/bash -c "conda list"

  # - if [[ $NAME == UNIT ]]; then pip install coveralls ; fi

before_script:
- "export DISPLAY=:99.0"
- "sh -e /etc/init.d/xvfb start"
- sleep 3
- export MKL_THREADING_LAYER=GNU

script:
  - if [[ $NAME == LINT ]]; then docker run --rm -it arviz:latest /bin/bash -c "./scripts/lint.sh" ; fi
  # - if [[ $NAME == UNIT ]]; then pytest -v arviz/tests/ --cov=arviz/ ; fi
  - if [[ $NAME == UNIT ]]; then . ./scripts/container.sh --test ; fi
  - if [[ $NAME == SPHINX ]]; then travis-sphinx build --nowarn --source=doc ; fi

after_success:
  - if [[ $NAME == SPHINX ]]; then travis-sphinx deploy; fi
  - if [[ $NAME == UNIT ]]; then coveralls ; fi
